"use strict";var _=function(e){return document.querySelector(e)},debug=function(e){var t=JSON.stringify(e,!0,2);console.log("========= Debug Javascript =========="),console.log(t),console.log("=====================================")},inputSearch=_(".input-search"),searchSnippet=_("#searchSnippet"),newSnippet=_("#newSnippet"),saveSnippet=_("#saveSnippet"),deleteSnippet=_("#deleteSnippet"),infoSnippet=_("#infoSnippet"),cancel=_("#cancel"),modal=_("#modal"),modalTitle=_(".modal-title"),modalContent=_(".modal-content"),overlay=_("#overlay"),copySnippet=_("#copySnippet"),loader=_("#loader"),codeEditor="",snippetUid=1;function initEditor(){codeEditor=CodeMirror.fromTextArea(window.editor,{lineNumbers:!0,lineWrapping:!0,tabMode:"indent",theme:"seti",mode:"text/x-textile"})}var newSnippetTpl='\n  <p><input type="text" id="title" placeholder="The title"/></p>\n  <p><select id="syntax">\n    <option value="javascript">Javascript</option>\n    <option value="vue">Vue</option>\n    <option value="python">Python</option>\n    <option value="php">Php</option>\n    <option value="lua">Lua</option>\n    <option value="markdown">Markdown</option>\n    <option value="css">Css</option>\n    <option value="scss">Scss</option>\n    <option value="less">Less</option>\n    <option value="html">Html</option>\n    <option value="c++">C++</option>\n    <option value="java">Java</option>\n  </select></p>\n  <p><textarea id="description" placeholder="The title"></textarea></p>\n  <p><button onclick="return formNewSnippet()" class="formSave">Save</button></p>\n';function snippet(e){return'<a class="snippet" href="#" onclick="getSnippetContent('.concat(e.uid,',this)" data-uid="').concat(e.uid,'">\n        <div class="snippet-title">').concat(e.title,'</div>\n        <div class="snippet-description">').concat(e.description,'</div>\n        <div class="snippet-type"><b>Syntax: </b> ').concat(e.syntax,"</div>\n    </a>")}function clearActive(){var e=document.querySelectorAll("#app-sidebar-content a[data-uid]");Array.from(e).forEach(function(e){e.classList.remove("active")})}function getSnippets(){_("#app-sidebar-content").innerHTML="<p>Loading..</p>";setTimeout(function(){return pywebview.api.init("Get snippets").then(function(e){_("#app-sidebar-content").innerHTML="",Array.from(e).forEach(function(e){_("#app-sidebar-content").innerHTML+=snippet(e)})})},500)}function filterSnippets(e){var t=setTimeout(function(){_("#app-sidebar-content").innerHTML="<p>Loading..</p>",pywebview.api.filter_snippet(e).then(function(e){_("#app-sidebar-content").innerHTML="",Array.from(e).forEach(function(e){_("#app-sidebar-content").innerHTML+=snippet(e)})}),clearTimeout(t)},500)}function checkEditorMode(e){var t="text/markdown";switch(e=e.toLowerCase()){case"javascript":t="text/javascript";break;case"vue":t="text/x-vue";break;case"python":t="text/x-python";break;case"php":t="application/x-httpd-php";break;case"lua":t="text/x-lua";break;case"markdown":t="text/x-markdown";break;case"css":t="text/css";break;case"scss":t="text/x-scss";break;case"less":t="text/x-less";break;case"html":t="text/html";break;case"c++":t="text/x-c++src";break;case"java":t="text/x-java"}return t}function getSnippetContent(e,t){codeEditor.setValue("loading....");var n=setTimeout(function(){pywebview.api.get_snippet(e).then(function(e){setModalInfo({title:e.data.title,description:e.data.description,syntax:e.data.syntax,date:e.data.date});var t=checkEditorMode(e.data.syntax);codeEditor.setValue(atob(e.data.content)),codeEditor.setOption("mode",t),snippetUid=e.data.uid,clearActive(),_('a[data-uid="'+snippetUid+'"]').classList.add("active")}),clearTimeout(n)},100)}function setModalInfo(e){modalTitle.innerHTML=e.title,modalContent.innerHTML="<p>".concat(e.description,"</p>\n    <p><b>Syntax: </b> ").concat(e.syntax,"</p>\n    <p><b>Date: </b> ").concat(e.date,"</p>")}function formNewSnippet(){var e=_("#title"),t=_("#description"),n=_("#syntax");if(2<e.value.length){var i={title:e.value,description:t.value,syntax:n.value};pywebview.api.set_snippet(i).then(function(e){e.status&&(getSnippets(),getSnippetContent(snippetUid),overlay.classList.remove("show"),modal.classList.remove("show"),modalTitle.innerHTML="",modalContent.innerHTML="")})}else alert("Please provide a title")}function createNewSnippet(){modalTitle.innerHTML="Create new Snippet",modalContent.innerHTML=newSnippetTpl,overlay.classList.add("show"),modal.classList.add("show"),cancel.addEventListener("click",function(e){overlay.classList.remove("show"),modal.classList.remove("show"),modalTitle.innerHTML="",modalContent.innerHTML="",getSnippetContent(snippetUid)},!1)}function initApp(){initEditor(),getSnippets();var e=setTimeout(function(){getSnippetContent(snippetUid),clearTimeout(e)},500);saveSnippet.addEventListener("click",function(e){e.preventDefault();var t=btoa(codeEditor.getValue()),n={uid:snippetUid,content:t};pywebview.api.put_snippet(JSON.stringify(n)).then(function(e){0==e.status?alert("The Snippet is not updated"):alert("The Snippet has been updated")})},!1),deleteSnippet.addEventListener("click",function(e){e.preventDefault(),pywebview.api.del_snippet(snippetUid).then(function(e){return 1==e.status&&(getSnippets(),getSnippetContent(1)),!1})},!1),newSnippet.addEventListener("click",function(e){return e.preventDefault(),createNewSnippet()},!1),infoSnippet.addEventListener("click",function(e){e.preventDefault(),overlay.classList.add("show"),modal.classList.add("show")},!1),cancel.addEventListener("click",function(e){e.preventDefault(),overlay.classList.remove("show"),modal.classList.remove("show"),modalTitle.innerHTML="",modalContent.innerHTML="",getSnippetContent(snippetUid)},!1),searchSnippet.addEventListener("click",function(e){e.preventDefault(),inputSearch.classList.toggle("hide")},!1),inputSearch.addEventListener("keyup",function(e){return 13==e.which||13==e.keyCode?(inputSearch.classList.toggle("hide"),inputSearch.value="",getSnippets(),!1):2<e.target.value.length?(filterSnippets(e.target.value),!1):!(e.target.value.length<1)||(getSnippets(),!1)}),_(".CodeMirror").addEventListener("click",function(e){return inputSearch.classList.add("hide"),inputSearch.value="",!1})}document.addEventListener("DOMContentLoaded",function(){initApp();var e=setTimeout(function(){loader.style.display="none",clearTimeout(e)},2e3)});